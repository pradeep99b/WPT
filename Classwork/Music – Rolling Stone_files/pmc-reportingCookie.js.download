var pmcPiano;!function(){var e={533:function(e){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},n.apply(this,arguments)},t=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function l(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,l)}c((i=i.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(a=0)),a;)try{if(t=1,i&&(o=2&l[0]?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(e,a)}catch(e){l=[6,e],i=0}finally{t=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},o=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var i,o=0,r=n.length;o<r;o++)!i&&o in n||(i||(i=Array.prototype.slice.call(n,0,o)),i[o]=n[o]);return e.concat(i||Array.prototype.slice.call(n))},r={cookieLabel:"pmc_piano_reporting",canDebug:window.pmcPianoData.canDebug,reporting:{entitlements:"",user_type:"ANONYMOUS",acct_id:null,acct_type:null,org_id:null,org_name:null,paywall_logged_in:!1},initialize:function(){var e=this;e.hasReportingCookie()||e.set(JSON.stringify(e.reporting)),window.pmcPiano.piano.registerOnLoggedInUserCallback(e.setDataForAuthUser.bind(e)),window.pmcPiano.piano.registerOnLoggedOutUserCallback(e.delete.bind(e)),window.pmcPiano.piano.registerOnHasIPUserCallback((function(){e.reporting.acct_type="ip",e.reporting.user_type="KNOWN",e.set(JSON.stringify(e.reporting))}))},set:function(e){this.canDebug&&console.log("PMC: Piano: Setting pmc_piano_reporting cookie",e),window.pmc.cookie.set(this.cookieLabel,e,604800,"/","targeting")},delete:function(){this.canDebug&&console.log("PMC: Piano: Deleting pmc_piano_reporting cookie",this.cookieLabel),window.pmc.cookie.expire(this.cookieLabel,"/")},getDataForAuthUser:function(){var e,n,r,a,l,c;return t(this,void 0,void 0,(function(){var t,u,s,d,p,v,g,f,m,h,_,y,w,b,P,k=this;return i(this,(function(i){switch(i.label){case 0:return[4,window.pmcPiano.pianoApi.tpCallApiPromise("/conversion/list")];case 1:t=null!==(n=null===(e=i.sent())||void 0===e?void 0:e.conversions)&&void 0!==n?n:[],u=null!==(r=t.sort((function(e,n){return n.create_date-e.create_date}))[0])&&void 0!==r?r:void 0,t=t.filter((function(e){var n;return null===(n=null==e?void 0:e.user_access)||void 0===n?void 0:n.granted})),t=0>=t.length?[u]:function(e){var n=[];return 1>=e.length?e:(["( |^)corporate","( |^)education","( |^)partner","( |^)agent","( |^)billboard member","( |^)employee","( |^)comp","( |^)(limited|registration)"].forEach((function(t){for(var i,r,a,l=0;l<e.length;l++){var c=e[l];(null===(a=null===(r=null===(i=null==c?void 0:c.term)||void 0===i?void 0:i.resource)||void 0===r?void 0:r.name)||void 0===a?void 0:a.match(new RegExp(t,"i")))&&(n=o(o([],n,!0),[c],!1),e.splice(l,1),l--)}})),0<e.length&&(n=o(o([],e,!0),n,!0)),n)}(o([],t,!0)),s=function(e,n){var t,i,o=function(e){var n,t,i=null===(t=null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.resource.name)||void 0===t?void 0:t.toLocaleLowerCase();return(null==i?void 0:i.match(/( |^)agent/))?"agent":(null==i?void 0:i.match(/( |^)(corporate|education|employee|partner)/))?"site_license":"individual"},r=o(e);if(1>=n.length)return r;var a=n.slice(1).map((function(e){return o(e)})),l="individual"===r,c=a.includes("agent"),u=a.includes("site_license");return l&&c&&u?"individual|site_license|agent":l&&u&&!c?"individual|site_license":l&&c&&!u?"individual|agent":"site_license"===r&&c?"site_license|agent":(k.canDebug&&console.log("User might have duplicate resources. userId: ".concat(null===(i=null===(t=null==e?void 0:e.user_access)||void 0===t?void 0:t.user)||void 0===i?void 0:i.uid," accountType: ").concat(r)),r)}(t[0],t),d=function(e){return e&&("email_domain_contract"===(null==e?void 0:e.type)||"specific_email_addresses_contract"===(null==e?void 0:e.type))},p=Array.from(new Set(t.map((function(e){var n;return null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.resource.name})))).join("|")||void 0,v=Array.from(new Set(t.map((function(e){var n;return null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.name})))).join("|")||void 0,g=Array.from(new Set(t.map((function(e){return(null==e?void 0:e.user_access)||(null==e?void 0:e.term)?window.pmcPiano.pianoApi.getAuthUserType(e):void 0})))).sort((function(e,n){return e.localeCompare(n)})).join("|")||void 0,f=[],m=0,h=t,i.label=2;case 2:return m<h.length?(_=h[m],(null===(a=null==_?void 0:_.term)||void 0===a?void 0:a.term_id)&&d(null==_?void 0:_.term)?(w=(y=f).push,[4,window.pmcPiano.pianoApi.getLicenseeData(_.term.term_id)]):[3,4]):[3,5];case 3:w.apply(y,[i.sent()]),i.label=4;case 4:return m++,[3,2];case 5:return b=Array.from(new Set(f.map((function(e){return null==e?void 0:e.id})))).join("|")||void 0,P=Array.from(new Set(f.map((function(e){return null==e?void 0:e.name})))).join("|")||void 0,[2,{accessGrantedStatus:null!==(c=null===(l=t[0])||void 0===l?void 0:l.user_access.granted)&&void 0!==c&&c,accountTermType:s,resourceName:p,termName:v,orgId:b,orgName:P,userType:g}]}}))}))},setDataForAuthUser:function(e){var o=e.uid;return t(this,void 0,void 0,(function(){var e,t,r,a;return i(this,(function(i){switch(i.label){case 0:return(null==(t=(e=this).hasReportingCookie())?void 0:t.acct_id)===o?[2,Promise.resolve()]:[4,this.getDataForAuthUser()];case 1:return r=i.sent(),a={acct_id:o,acct_type:r.accountTermType,entitlements:r.resourceName,paywall_logged_in:r.accessGrantedStatus,user_type:r.userType,org_id:r.orgId||null,org_name:r.orgName||null},this.reporting=n(n({},e.reporting),a),e.set(JSON.stringify(this.reporting)),[2,Promise.resolve()]}}))}))},hasReportingCookie:function(){try{return JSON.parse(window.pmc.cookie.get("pmc_piano_reporting")||null)}catch(e){if(this.canDebug)return console.log("PMC: Piano: No reporting cookie",e.toString()),!1}}};r.initialize(),e.exports=r}},n={},t=function t(i){var o=n[i];if(void 0!==o)return o.exports;var r=n[i]={exports:{}};return e[i].call(r.exports,r,r.exports,t),r.exports}(533);(pmcPiano=void 0===pmcPiano?{}:pmcPiano).reportingCookie=t}();