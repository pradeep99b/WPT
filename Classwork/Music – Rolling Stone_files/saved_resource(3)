(()=>{"use strict";({init(){window.pmc.hooks.add_filter("cxense_entitlements",((i,{has:e,or:t,exec:l})=>l({"rs-reg":t(e("RS.REG"),e("Rolling Stone Digital Registration")),"rs-com":t(e("RollingStone.COM"),e("RollingStone.BUNDLE"),e("Rolling Stone Digital"),e("Rolling Stone Digital + Print"),e("Rolling Stone Digital, Corporate Membership"),e("Rolling Stone Digital, Educational Membership"),e("Rolling Stone Digital, agent subscription"),e("Comped User - Rolling Stone Digital"),e("Rolling Stone Digital, Employee Complimentary Membership"))})||i))}}).init()})();;
!function(){var e={541:function(){window.pmc=window.pmc||{},window.pmc.subscription_v2=window.pmc.subscription_v2||{},window.pmc.subscription_v2={is_paywall_content:!!window.pmc_subscription_v2_config.isPaywallContent,is_single_post:!!window.pmc_subscription_v2_config.isSinglePost,is_admin_user:!!window.pmc_subscription_v2_config.isAdminUser,is_token_user:!!window.pmc_subscription_v2_config.isTokenUser,iframe_refresh_token_id:"iframe_refresh_token",ajax_url:`https://${window.location.host}/wp-admin/admin-ajax.php`,login_link:window.pmc_subscription_v2_config.loginLink,is_ip_auth_enabled:!!window.pmc_subscription_v2_config.isIpAuthEnabled,subscriber_data:{},brands:{vy:"vy",rs:"rs",wwd:"wwd"},entitlement_translation_config:{wwd:{archive:[["WWD.ARCHIVE"]],"archive-dd":[["WWD.ARCHIVE","WWD.DD"],["WWD.ARCHIVE","WWD.COMBO"]],annual:[["WWD.COM"]],"annual-dd":[["WWD.COMBO"],["WWD.COMBO","WWD.DD"],["WWD.COM","WWD.DD"]],"digital-daily":[["WWD.DD"]],"wwd-reg":[["WWD.REG"]]},vy:{"variety-vip":[["Variety.VarietyVIP"]],"vy-reg":[["VY.REG"]]},rs:{"rs-com":[["RollingStone.COM"]],"rs-reg":[["RS.REG"]]}},brand_name:window.pmc_subscription_v2_config.brandName,subscriber_data_listeners:[],render_links_from_theme:!1,get_cookie_data:function(e){var s=pmc.subscription_v2,t=s.ajax_url,r=s.get_xhr_get(t,"?action=pmc_get_cookie_data_ajax_callback");r.onload=function(){e&&e(JSON.parse(r.response),r.status)},r.send()},get_random:function(){const e=()=>Math.random().toString(36).substring(2,15);return e()+e()},listen_for_refresh_iframe_postmessage:function(e){if(e.data&&window.pmc_subscription_v2_config.authApiOrigin===e.origin){var s=pmc.subscription_v2,t=!1,r=!1;try{var i=JSON.parse(e.data)}catch(t){i=e.data,r=!0,Rollbar.warn("Failed to parse response from Auth API",{data:i,session:s.get_session_data()})}if(!1!==r||i.hasOwnProperty("jwt")||Rollbar.warn("Unexpected token refresh data returned from Auth API",{data:i,session:s.get_session_data()}),""===i.jwt)switch(i.message){case"login_required":var n=s.ajax_url,a="?action=pmc_delete_subscriber_session_cookie_callback";s.get_xhr_get(n,a).send(),t=!0,Rollbar.info("login_required returned from Auth API",{data:i,session:s.get_session_data()});break;case"site_license_mismatch":n=s.ajax_url,a="?action=pmc_delete_subscriber_cookie_ajax_callback",s.get_xhr_get(n,a).send(),t=!0,MicroModal.show("pmc-subscription__site-license-mismatch-modal"),Rollbar.info("site_license_mismatch returned from Auth API",{data:i,session:s.get_session_data()});break;default:!1===r&&Rollbar.warn("Unexpected token refresh message returned from Auth API",{data:i,session:s.get_session_data()})}if(i.jwt&&"success"===i.message&&(n=s.ajax_url,a="?action=token_refresh_ajax_callback&jwt="+i.jwt,s.get_xhr_get(n,a).send(),t=!0),t){var o=document.getElementById(s.iframe_refresh_token_id);o&&o.remove()}}},create_refresh_iframe:function(e){var s=pmc.subscription_v2;if(e.user&&e.jwt&&!s.is_logged_in_action()){window.addEventListener("message",s.listen_for_refresh_iframe_postmessage);var t=document.createElement("iframe");t.setAttribute("style","display:none;width:0;height:0"),t.setAttribute("id",s.iframe_refresh_token_id),t.src=window.pmc_subscription_v2_config.tokenRefreshUrl+"?jwt="+e.jwt+"&ip="+e.user.ip.join(),t.referrerPolicy="origin",document.body.appendChild(t)}},ip_auth:function(e){var s=pmc.subscription_v2,t=s.get_xhr_get(s.ajax_url,"?action=pmc_authenticate_by_ip");t.onload=function(){e&&e(JSON.parse(t.response),t.status)},t.send()},get_xhr_get:function(e,s){var t=pmc.subscription_v2,r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return r.open("GET",e+s+"&r="+t.get_random()),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r},get_session_data:function(){try{return pmc.subscription_v2.subscriber_data.session}catch(e){return Rollbar.warn("Failed get_session_data",{error:e}),{}}},has_session:function(){return"true"===pmc.cookie.get("pmcsc_sub_has_session")},has_session_data:function(e){var s=pmc.subscription_v2;return!!(s.has_subscriber_data()&&s.subscriber_data.hasOwnProperty("session")&&s.subscriber_data.session)&&(void 0===e||""===e||s.subscriber_data.session.hasOwnProperty(e))},has_user:function(){var e=pmc.subscription_v2;return"true"===pmc.cookie.get("pmcsc_sub_has_user")||e.is_admin_user||e.is_token_user},has_user_data:function(e){var s=pmc.subscription_v2;return!!(s.has_subscriber_data()&&s.subscriber_data.hasOwnProperty("user")&&s.subscriber_data.user)&&(void 0===e||""===e||s.subscriber_data.user.hasOwnProperty(e))},has_unknownip:function(){return"true"===pmc.cookie.get("pmcsc_sub_unknownip")},has_site_license:function(){var e=pmc.subscription_v2;return!!(e.has_user_data("site_license")&&e.subscriber_data.user.site_license.hasOwnProperty("salesforce_account_id")&&e.subscriber_data.user.site_license.hasOwnProperty("user_ip"))&&""!==e.subscriber_data.user.site_license.salesforce_account_id&&""!==e.subscriber_data.user.site_license.user_ip},has_entitlements:function(e,s){var t=pmc.subscription_v2;return e=void 0===e?[]:e,s=void 0===s?"or":s,!!t.has_user_data("entitlements")&&(e.length>0&&Array.isArray(e)&&t.subscriber_data.user.entitlements.length>0?"and"===s?e.every((function(e){return t.subscriber_data.user.entitlements.indexOf(e)>=0})):e.some((function(e){return t.subscriber_data.user.entitlements.indexOf(e)>=0})):t.subscriber_data.user.entitlements.length>0)},only_has_one_entitlement:function(e){const s=pmc.subscription_v2,t=s.has_user_data("entitlements")?s.subscriber_data.user.entitlements:[];return!!(e.length>0&&Array.isArray(t))&&Array.isArray(t)&&Array.isArray(e)&&t.every(((s,t)=>s===e[t]))},get_brands_entitlements:function(e){const s=pmc.subscription_v2;return!s.has_user_data("entitlements")||s.subscriber_data.user.entitlements?s.subscriber_data.user.entitlements.filter((s=>e.some((e=>s.includes(e))))):[]},has_account_type_individual:function(){return"individual"===pmc.subscription_v2.subscriber_data.user.acct.type.toLowerCase()},is_restricted:function(){var e=pmc.subscription_v2;return!!e.has_session_data("concurrency_restricted")&&e.subscriber_data.session.concurrency_restricted},is_registered_user:function(){var e=pmc.subscription_v2;if(e.has_user_data()&&e.subscriber_data.user.acct.hasOwnProperty("reg")&&e.subscriber_data.user.acct.reg.hasOwnProperty(e.brands[e.brand_name])){var s=e.subscriber_data.user.acct.reg[e.brands[e.brand_name]];if(s.hasOwnProperty("cam")&&s.hasOwnProperty("date"))return s.cam>0&&s.date.match(/^\d{4}-\d{2}-\d{2}$/).length>0}return!1},get_registered_user_data:function(){var e=pmc.subscription_v2;return e.subscriber_data.user.acct.reg[e.brands[e.brand_name]]},render_links:function(){var e=pmc.subscription_v2;if(!e.render_links_from_theme){var s=function(e,s){var t=document.querySelector(e);if(t){var r=s?"":"none";t.style.display=r}};if(e.has_user()&&e.has_session()&&!e.is_logged_out_action()){var t=document.querySelector(".subscription-links");t&&(t.className=t.className.replace("user-not-logged-in",""));var r=document.querySelector(".subscriber-name .replace-username"),i=document.querySelectorAll(".subscriber-logout-link");r&&(r.innerText=e.subscriber_data.user.given_name),i&&i.forEach((function(s){s.href=s.href+"&session-id="+e.subscriber_data.session.session_id})),s(".subscriber-name",!0),s(".subscribe-link",!1),document.querySelectorAll(".subscriber-login-link").forEach((function(e){e.style.display="none"})),e.has_site_license()||(s(".subscriber-logout-link",!0),s(".subscriber-self-care-link",!0))}else s(".subscribe-link",!0),document.querySelectorAll(".subscriber-login-link").forEach((function(e){e.style.display=""})),document.querySelectorAll("[href^='"+e.login_link+"']").forEach((function(e){e.addEventListener("click",(function(e){var s=this.getAttribute("href");try{e.preventDefault(),Rollbar.debug("User clicked subscriber-login-link",(function(){window.location.href=s}))}catch(e){window.location.href=s}}))}))}},has_subscriber_data:function(){return Object.keys(this.subscriber_data).length>0},is_logged_in_action:function(){return"logged_in"===pmc.subscription_v2.get_url_params().get("sub_action")},is_logged_out_action:function(){return"logged_out"===pmc.subscription_v2.get_url_params().get("sub_action")},on_subscriber_data_loaded:function(e,s){s=s||function(){},this.has_user()&&this.has_subscriber_data()?e(this.subscriber_data):this.has_session()||this.is_admin_user||this.is_token_user?this.subscriber_data_listeners.push(e):s()},may_show_concurrency_restricted_modal:function(e){var s=pmc.subscription_v2;if(!s.is_paywall_content||!s.is_single_post||!s.has_session())return!1;if(e&&e.session.concurrency_restricted){var t=window.pmc_subscription_v2_config.concurrencyText,r=window.pmc_subscription_v2_config.concurrencyHeaderText,i=document.querySelector("#pmc-subscription__concurrency-restricted-modal-message");i&&(i.innerText=t);var n=document.querySelector("#pmc-subscription__concurrency-restricted-modal .modal__header h4");n&&(n.innerText=r),MicroModal.show("pmc-subscription__concurrency-restricted-modal")}},may_show_account_login_modal:function(e){var s=pmc.subscription_v2.subscriber_data.user.acct.type;if(-1!==["Agents","Corporate","Site License"].indexOf(s)){e.preventDefault();var t="",r="";switch(s){case"Agents":r="Contact customer service",t=window.pmc_subscription_v2_config.contactAgentsText;break;case"Corporate":case"Site License":r="Contact your corporate administrator",t=window.pmc_subscription_v2_config.contactCorporateText}var i=document.querySelector("#pmc-subscription__account-login-message");i&&(i.innerText=t);var n=document.querySelector("#pmc-subscription__account-login-header");n&&(n.innerText=r),MicroModal.show("pmc-subscription__account-login-modal")}},may_show_verify_identity_modal:function(){var e=pmc.subscription_v2;if(!(e.has_session()||e.has_site_license()||e.is_admin_user||e.is_token_user)){var s=document.getElementById("pmc-subscription__verify-identity-dismiss");s&&s.addEventListener("click",e.delete_subscriber_cookie),e.is_paywall_content&&e.is_single_post&&MicroModal.show("pmc-subscription__verify-identity-modal")}},trigger_user_data_listeners:function(){var e=this;0!==e.subscriber_data_listeners.length&&(e.has_subscriber_data()?(e.subscriber_data_listeners.forEach((function(s){s(e.subscriber_data)})),e.subscriber_data_listeners=[]):console.error("User data listeners triggered, but no user data exists."))},override_rendering_links:function(){this.render_links_from_theme=!0},window_load_event:function(e){"complete"===document.readyState?e():window.addEventListener("load",e)},may_show_subscriber_error_modal:function(){var e=pmc.subscription_v2.get_url_params(),s=e.get("sub_error");if("error"===e.get("sub_action")&&s&&""!==s){var t=document.querySelector("#pmc-subscription__subscriber-error-message");t&&(t.innerText=window.pmc_subscription_v2_config.supportText);var r=document.querySelector("#pmc-subscription__subscriber-error-modal .modal__header h4");r&&(r.innerText=s),MicroModal.show("pmc-subscription__subscriber-error-modal")}},delete_subscriber_cookie:function(e){if(!this.getAttribute("data-logout-action")){e.preventDefault();var s=this,t=pmc.subscription_v2,r=t.ajax_url,i=t.get_xhr_get(r,"?action=pmc_delete_subscriber_cookie_ajax_callback");return i.onload=function(){var e=JSON.parse(this.response),r=t.get_url_params(s.href).get("session-id");if(void 0!==r&&""!==r)if(200===this.status&&!0===e.success){s.setAttribute("data-logout-action",!0);try{Rollbar.info("User logged out",{has_session_data:t.has_session_data(),session_id:r},(function(){s.click()}))}catch(e){s.click()}}else Rollbar.warn("Logout AJAX failed",{session:t.get_session_data(),xhrStatus:this.status,xhrStatusText:this.statusText,xhrResponse:e,xhrResponseURL:this.responseURL});else Rollbar.warn("Logout URL missing session-id",{session:t.get_session_data()})},i.send()}},get_url_params:function(e){var s="";if(void 0===e||""===e)s=window.location.search;else{var t=e.split("?");t[1]&&(s=t[1])}return"URLSearchParams"in window?new URLSearchParams(s):{get:function(){return""}}},set_body_class:function(){this.has_user()&&document.body.classList.add("pmc-subscription-has-user"),this.has_entitlements()&&this.subscriber_data.user.entitlements.forEach((function(e){document.body.classList.add("pmc-subscription-user-entitlement-"+e.replace(".","_").toLowerCase())})),this.has_session()&&document.body.classList.add("pmc-subscription-user-has-session")},get_translated_entitlement:function(){var e=this;if(e.brand_name&&e.has_entitlements()){var s=e.brand_name,t=e.entitlement_translation_config[s],r=null,n=0;for(key in t)for(i=0;i<t[key].length;i++)this.has_entitlements(t[key][i].sort(),"and")&&n<t[key][i].length&&(r=key,n=t[key][i].length);return r}},send_onesignal_tags:function(){if("undefined"!=typeof OneSignal){var e="free";this.has_entitlements()&&(e=this.get_translated_entitlement()),OneSignal&&OneSignal.sendTags&&OneSignal.sendTags({subscription_status:e})}},set_authenticated_user_id:function(){var e=window.blogherads||{},s=null;this.has_user_data("acct")&&(s=this.subscriber_data.user.acct.contact_id),console.log("PMC: set_authenticated_user_id",s),e.adq=e.adq||[],e.adq.push((function(){try{e.setAuthenticatedUserId(s,"soa")}catch(e){}}))},init:function(){var e=this;e.window_load_event((function(){e.set_body_class(),e.may_show_subscriber_error_modal(),document.querySelectorAll(".subscriber-logout-link").forEach((function(s){s.addEventListener("click",e.delete_subscriber_cookie)}))})),e.has_user()&&!e.is_logged_out_action()?e.get_cookie_data((function(s,t){200===t&&s.success?(e.subscriber_data=s.data,e.trigger_user_data_listeners(),e.send_onesignal_tags(),e.window_load_event((function(){e.render_links(),e.create_refresh_iframe(e.subscriber_data),e.may_show_concurrency_restricted_modal(e.subscriber_data),e.may_show_verify_identity_modal(),e.set_authenticated_user_id();var s=document.querySelector(".subscriber-self-care-link");s&&s.addEventListener("click",e.may_show_account_login_modal)}))):Rollbar.warn("Subscriber data fetch failed",{session:e.get_session_data(),xhrStatus:t,xhrResponse:s})})):e.window_load_event((function(){e.render_links()})),!e.is_ip_auth_enabled||e.has_unknownip()||e.has_user()||e.is_logged_in_action()||e.ip_auth((function(e,s){if(200===s&&e.success){try{var t=JSON.parse(decodeURIComponent(pmc.cookie.get("pmcsc_sub_reporting_data")))||{},r=t.acct||{},i=t.entitlements.length>0&&t.entitlements.join(",");Rollbar.info("User authenticated by IP Auth",{sf_account_id:r.acct_id||!1,sf_contact_id_id:r.contact_id||!1,entitlements:i})}catch(e){}window.location.href=window.location.href+"?sub_action=logged_in"}}))}},window.pmc.subscription_v2.init()}},s={};function t(r){var i=s[r];if(void 0!==i)return i.exports;var n=s[r]={exports:{}};return e[r](n,n.exports,t),n.exports}t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,{a:s}),s},t.d=function(e,s){for(var r in s)t.o(s,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},function(){"use strict";t(541)}()}();;
